!function(){function o(o,t){return function(o){if(Array.isArray(o))return o}(o)||function(o,n){var t=null==o?null:"undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(null==t)return;var e,a,r=[],i=!0,c=!1;try{for(t=t.call(o);!(i=(e=t.next()).done)&&(r.push(e.value),!n||r.length!==n);i=!0);}catch(o){c=!0,a=o}finally{try{i||null==t.return||t.return()}finally{if(c)throw a}}return r}(o,t)||function(o,t){if(!o)return;if("string"==typeof o)return n(o,t);var e=Object.prototype.toString.call(o).slice(8,-1);"Object"===e&&o.constructor&&(e=o.constructor.name);if("Map"===e||"Set"===e)return Array.from(o);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return n(o,t)}(o,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(o,n){(null==n||n>o.length)&&(n=o.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=o[t];return e}!function(n,t,e){t.behaviors.mapControls={attach:function(o,n){var t=this;L.Map.addInitHook((function(){var o;"comparison-map"==(null===(o=this.options)||void 0===o?void 0:o.mapName)?t.bindLayerControls(this,"comparison-map"):(t.bindLayerControls(this,"main-map"),t.bindZoomControls(this),t.bindLocateControl(this),this.removeControl(this.zoomControl)),this.on("unload",(function(){var o;"comparison-map"==(null===(o=this.options)||void 0===o?void 0:o.mapName)?t.unBindLayerControls("comparison-map"):t.unBindLayerControls("main-map")}))}))},bindLayerControls:function(o,t){var e=this,a=n(".map-controls__map-layer.".concat(t," .map-controls__map-layer-item"));a.on("click",(function(t){var r=n(t.target).data("map-layer-title");mapApiEndpoints=n(t.target).data("map-api-endpoints"),e.handleLayerSelection(o,r,mapApiEndpoints),a.removeClass("active"),n(t.target).addClass("active")}))},unBindLayerControls:function(o){n(".map-controls__map-layer.".concat(o," .map-controls__map-layer-item")).off("click")},handleLayerSelection:function(o,n,t){var e=this;"present"!=n?t&&t.forEach((function(t){e.addMapLayer(o,t,n)})):e.removeOtherMapLayers(o,null)},addMapLayer:function(o,n,t){var e=this,a=e.getMapApiUrl(n.map_api);e.showLoadingSpinner();var r=L.tileLayer.wms(a,{layers:n.wms_title,format:"image/png",transparent:!0,className:t});r.addTo(o),r.on("load",(function(n){e.removeOtherMapLayers(o,t),e.hideLoadingSpinner()}))},removeOtherMapLayers:function(n,t){var e,a=Object.entries(n._layers).filter((function(n){var t,e=o(n,2);e[0];return null===(t=e[1].wmsParams)||void 0===t?void 0:t.layers}));(e=t?a.filter((function(n){var e=o(n,2);e[0];return e[1].options.className!==t})):a).length&&e.forEach((function(o){return o[1].remove()}))},getMapApiUrl:function(o){switch(o){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){n("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){n("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(o){var t=n(".map-controls__control-button#zoom-in-btn"),e=n(".map-controls__control-button#zoom-out-btn");t.on("click",(function(){o.zoomIn()})),e.on("click",(function(){o.zoomOut()}))},bindLocateControl:function(o){var t=this;n(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(t.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((function(n){t.hideLoadingSpinner();var e=n.coords.latitude,a=n.coords.longitude;t.addUserLocationMarker(e,a,o),o.panTo([e,a]),o.setZoom(15)}),(function(o){1===o.code&&t.showGeolocationDeniedBox(),t.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},addUserLocationMarker:function(o,n,t){var e=new L.LatLng(o,n),a=L.icon({iconSize:["36","36"],iconUrl:"/themes/custom/hdbt_subtheme/src/icons/user.svg"});L.marker(e,{icon:a}).addTo(t)},showGeolocationDeniedBox:function(){var o=this,e=t.t("Location data blocked",{},{context:"Map selectors"}),a=t.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),r=t.t("Close",{},{context:"Map selectors"});n(".leaflet-container").prepend('\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>'.concat(e,'</h3>\n              <div class="close-btn" role="button">').concat(r,"</div>\n            </div>\n            <p>").concat(a,"</p>\n          </div>\n        </div>\n      ")),n("#geolocation-denied-overlay").fadeIn(150),n("#geolocation-denied-overlay .close-btn").on("click",(function(){o.hideGeoloactionDeniedBox()})),n(document).keyup((function(n){27===n.keyCode&&o.hideGeoloactionDeniedBox()}))},hideGeoloactionDeniedBox:function(){n("#geolocation-denied-overlay").fadeOut(150)}}}(jQuery,Drupal,drupalSettings)}();